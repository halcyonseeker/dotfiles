#!/bin/sh
# Default handler for magnet links
# Called by ~/.local/share/applications/{torrent.desktop, mimeapps.list}
# Depends on transmission-cli, notify-send, and dunst

set -eu

[ -z "$1" ] && {
	notify-send "ðŸŒ± Torrent Handler" "Failed: Command Line Empty"
	exit 1
}

pgrep -x transmission-da >/dev/null || {
	transmission-daemon -w ~/temporary && \
		notify-send "ðŸŒ± Torrent Handler" "Starting transmission-daemon..."
}

sleep 5

if (transmission-remote -a "$1" -e "$XDG_CACHE_HOME"/transmission-da.log); then
	notify-send "ðŸŒ± Torrent Handler" "Added $1"
else
	notify-send "ðŸŒ± Torrent Handler" \
		"Failed: Unable to Add Torrent. See ~/torrent-add.err"
fi
