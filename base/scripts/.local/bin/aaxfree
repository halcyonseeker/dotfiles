#!/bin/sh
# Convert Audible .aax files into DRM-free ogg/opus
# Depends on ffmpeg
# TODO: determine which bytes to use

message_function () {
    if [ -n "$(pgrep dunst)" ] ; then
    	notify-send "$1"
    else
    	echo "$1"
    fi
}

[ -f "$1" ] || message_function "$1 not found"
opusname="$(echo "$1" | sed "s/aax/opus/")"
bytes=7601152f
if (ffmpeg -activation_bytes "$bytes" -i "$1" "$opusname") ; then
    message_function "$opusname created"
else
    message_function "Unable to create $opusname"
fi
