#
# FVWM Configuration
#

#
################################################################ General
#
# Desktops
EdgeResistance 250 10
EdgeThickness  1
EdgeScroll     100 100
ClickTime      750
DesktopSize    1x4
DesktopName    0 Primary
DesktopName    1 Secondary
DesktopName    2 Tertiary

# Default terminal
InfoStoreAdd terminal xterm -ti vt340

# Startup
AddToFunc StartFunction "I" Module FvwmButtons Dock

# Fonts
WindowFont "xft:Sans:Italic:size=10:antialias=True"
IconFont   "xft:Sans:Bold:size=8:antialias=True"

# Transfer focus when switching pages
*FvwmEvent: new_page MoveFocus CurrentPage NoWarp

# Don't use wire frames
OpaqueMoveSize unlimited
Style "*" ResizeOpaque

# Transfer focus to the most recently spawned window
Style * FPGrabFocus

# EwmhBaseStruts [left] [right] [top] [bottom]
# Reserves space along the right edge of the screen for the Dock module
EwmhBaseStruts 0 80 0 0

# Prevent Xterm and Emacs from leaving gaps
Style "*" ResizeHintOverride

#
#
##################################################### Modules and Things
#
# Virtual Desktop Pager
*FvwmPagerLabel   FvwmPager
*FvwmPagerFont    none
*FvwmPagerBack    skyblue4
*FvwmPagerFore    black
*FvwmPagerHilight slategray
*FvwmPager:       WindowLabelFormat ""
*FvwmPager:       SolidSeparators

Style Dock NoTitle, Sticky, WindowListSkip, CirculateSkip, \
      StaysOnBottom, FixedPosition, FixedSize, !Iconifiable
DestroyModuleConfig Dock: *                                   
*Dock: Geometry 65x270-1+1
*Dock: Rows     4
*Dock: Columns  1
*Dock: (2x2, Swallow "FvwmPager" `Module FvwmPager`)
*Dock: (2x1, Swallow "wmCalClock" `Exec wmCalClock -24`)
*Dock: (2x1, Title "Root Menu", Action(mouse 1) Menu RootMenu)

#
############################################################## Functions
#
# Resize window
DestroyFunc RaiseMove
AddToFunc   RaiseMove
+ I       Raise
+ M       $0

# Transfer focus when switching pages
DestroyFunc MoveFocus
AddToFunc   MoveFocus
+ I       All ($0, Focused) FlipFocus $1
+ I       TestRc (NoMatch) Prev ($0, AcceptsFocus) FlipFocus $1

# TODO Undecorate and fully maximize a window
# DestroyFunc FullscreenWin
# AddToFunc FullscreenWin
# + I ThisWindow (HasHandles) WindowStyle !Title, !Borders
# + I ThisWindow (!HasHandles) WindowStyle Title, Borders

#
######################################################## Mouse Bindings
#
# Syntax: Mouse Keyname Context Modifier Command Function
# Super + Mouse 1/3 - move/resize window
Mouse     1        W       M         RaiseMove Move
Mouse     3        W       M         RaiseMove Resize

# Root Window
Mouse     1        R       A         Menu RootMenu
Mouse     2        R       A         Menu WindowOps
Mouse     3        R       A         WindowList

# Title Bar Buttons
Mouse     0        1       A         Menu WindowOps 
Mouse     0        3       A         Close
Mouse     0        4       A         Iconify
Mouse     0        2       A         Maximize 100 100

# Click an icons to de-iconify
Mouse     1        I       A         Iconify

#
########################################################### Key Bindings
#
# Syntax: Key Keyname Context Modifier Command Function
# Ignore Numlock and other modifiers for bindings
IgnoreModifiers L25

# Meta + Space - Show root menu from anywhere
Key       Space    A       4         Menu RootMenu

# Meta + Tab - Cycle through windows with WindowList
Key       Tab      A       4         WindowList Root c c NoDeskSort, SelectOnRelease Meta_L

# Meta + Shift (h/j/k/l || Left/Down/Up/Right):
# Move focused window left/down/up/right
Key       h        A       MS        Move w-2 w+0
Key       j        A       MS        Move w+0 w+2
Key       k        A       MS        Move w+0 w-2
Key       l        A       MS        Move w+2 w+0
Key       Left     A       MS        Move w-2 w+0 
Key       Down     A       MS        Move w+0 w+2
Key       Up       A       MS        Move w+0 w-2
Key       Right    A       MS        Move w+2 w+0

# Meta + Control + (h/j/k/l || Left/Down/Up/Right):
# Move focus to left/down/up/right page
Key       h        A       MC        Scroll -100 0
Key       j        A       MC        Scroll +0 +100
Key       k        A       MC        Scroll +0 -100
Key       l        A       MC        Scroll +100  +0
Key       Left     A       MC        Scroll -100 0
Key       Down     A       MC        Scroll +0 +100
Key       Up       A       MC        Scroll +0 -100
Key       Right    A       MC        Scroll +100  +0

# Meta + Control + m - maximise window
# TODO: Add vertical, horizontal and full screen maximization
Key       m        A       MC        Maximize 100 100
# Key       =        A       MC        Maximize 50 100
# Key       +        A       MC        Maximize 100 49
# Key       f        A       MC        FullscreenWin

# Meta + Control + i/s minimize/stick a window
Key       i        A       MC        Iconify
Key       s        A       MC        Stick

# Super + 1/2/3 - Go to desk 1/2/3
# TODO: add a few workspaces
# key       1        A       4         GotoDesk 0 0
# Key       2        A       4         GotoDesk 0 1
# Key       3        A       4         GotoDesk 0 2

#
################################################################## Menus
#
# Menu Styling
MenuStyle * Font "xft:Sans:Bold:size=10:antialias=True"

# Window operations menu
DestroyMenu WindowOps
AddToMenu   WindowOps
+ "Move"               Move
+ "Resize"             Resize
+ "(De)Iconify"        Iconify
+ "(Un)Maximize"       Maximize
+ "(Un)Shade"          WindowShade
+ "(Un)Sticky"         Stick
+ "(No)TitleBar"       Pick (CirculateHit) ToggleTitle
+ ""                   Nop
+ "Send to Main"       MoveToDesk 0 0 # Required b/c firefox is weird
+ ""                   Nop
+ "Close"              Close
+ "Destroy"            Destroy
+ ""                   Nop
+ "Raise"              Raise
+ "Lower"              Lower
+ ""                   Nop
+ "StaysOnTop"         Pick (CirculateHit) Layer 0 6
+ "StaysPut"           Pick (CirculateHit) Layer 0 4
+ "StaysOnBottom"      Pick (CirculateHit) Layer 0 2
+ ""                   Nop
+ "Identify"           Module FvwmIdent

# Root menu
DestroyMenu RootMenu
AddToMenu   RootMenu "Root Menu" Title
+ "Terminal"           Exec $[infostore.terminal]
+ "Connect to Emacs"   Exec emacsclient -c
+ "Emacs E-Mail"       Exec emacsclient -c -e '(mu4e)'
+ ""                   Nop
+ "Applications Menu"  Popup ApplicationsMenu
+ "Theme Menu"         Popup ThemesMenu
+ ""                   Nop
+ "Display Settings"   Exec arandr
+ "Kill X Program"     Exec xkill
+ ""                   Nop
+ "FVWM Console"       Module FvwmConsole -terminal xterm
+ "Refresh Fvwm"       Refresh
+ "Restart Fvwm"       Restart
+ "Exit Fvwm"          Popup QuitMenu

# TODO: Use piperead to get listing of XDG Desktop programs
DestroyMenu ApplicationsMenu
AddToMenu   ApplicationsMenu "Applications Menu" Title
+ "TODO"               Nop

DestroyMenu ThemesMenu
AddToMenu   ThemesMenu "Select Themes" Title
+ "Select Wallpaper"   Exec sxiv -t ~/images/wallpapers/* /storage/personal/Desktop/img/*
+ "FVWM Themes"        Popup FVWMThemesMenu
+ "Xresources Themes"  Popup XresourcesMenu

# TODO: Create some color and decoration themes for FVWm
DestroyMenu FVWMThemesMenu
AddToMenu   FVWMThemesMenu "FVWM Themes" Title
+ "TODO"               Nop

DestroyMenu XresourcesMenu
AddToMenu   XresourcesMenu "Xresources Themes" Title
+ "Clear Theme"        Exec xrdb -remove && xrdb -merge ~/.config/xresources/Xresources
+ ""                   Nop
+ "Gruvbox Dark"       Exec xrdb -merge ~/.config/xresources/gruvbox-dark.xres 
+ "Gruvbox Light"      Exec xrdb -merge ~/.config/xresources/gruvbox-light.xres 
+ "Parchment"          Exec xrdb -merge ~/.config/xresources/parchment.xres 

# Quit Menu
DestroyMenu QuitMenu
AddToMenu   QuitMenu
+ "Don't Exit"         Nop
+ "Exit Fvwm"          Quit
